<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Moja apka</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; max-width: 400px; margin: auto; padding: 20px; }
    label { display: block; margin-top: 15px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px; width: 100%; font-weight: bold; cursor: pointer; }
    span.value { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Wpisz dane ðŸ“¥</h1>
  <p>Instrukcja: 
    <br>1. Wpisz wszystkie dane z caps lockiem
    <br>2. Kliknij "Zapisz"
    <br>3. NaciÅ›nij "UdostÄ™pnij" na swojej przeglÄ…darce
    <br>4. NaciÅ›nij "Dodaj do ekranu gÅ‚Ã³wnego"
  </p>

  <form id="daneForm">
    <label>ImiÄ™: <input type="text" id="dane1" required></label>
    <label>Nazwisko: <input type="text" id="dane2" required></label>
    <label>Twoje zdjÄ™cie: <input type="file" id="zdjecie" accept="image/*" required></label>

    <h2>Wybierz datÄ™ urodzenia</h2>
    <label for="birthdate">Data: <span class="value" id="dateValue"></span></label>
    <input type="date" id="birthdate">

    <br><br>

    <label for="gender">PÅ‚eÄ‡: <span class="value" id="genderValue"></span></label>
    <select id="gender">
        <option value="">Wybierz...</option>
        <option value="KOBIETA">Kobieta</option>
        <option value="MÄ˜Å»CZYZNA">MÄ™Å¼czyzna</option>
    </select>

    <br><br>

    <label>TwÃ³j PESEL: <span class="value" id="peselValue">â€“</span></label>

    <button type="submit">Zapisz âœ…</button>
  </form>

  <script>
    // JeÅ›li dane juÅ¼ sÄ… â€” przekieruj
    if (localStorage.getItem("dane1")) {
      window.location.href = "logowanie.html";
    }

    const form = document.getElementById("daneForm");
    const birthdateInput = document.getElementById('birthdate');
    const genderSelect = document.getElementById('gender');
    const dateValue = document.getElementById('dateValue');
    const genderValue = document.getElementById('genderValue');
    const peselValue = document.getElementById('peselValue');

    // Pokazywanie aktualnego wyboru
    birthdateInput.addEventListener('input', () => {
      dateValue.textContent = birthdateInput.value;
      updatePesel();
    });

    genderSelect.addEventListener('change', () => {
      genderValue.textContent = genderSelect.value;
      updatePesel();
    });

    function updatePesel() {
      const date = birthdateInput.value;
      const gender = genderSelect.value;
      if (!date || !gender) {
        peselValue.textContent = "â€“";
        return;
      }

      peselValue.textContent = generatePesel(date, gender);
    }

    // Funkcja generujÄ…ca PESSEL (roleplay)
    function generatePesel(dateStr, gender) {
      const date = new Date(dateStr);
      const yy = date.getFullYear() % 100;
      const mm = date.getMonth() + 1;
      const dd = date.getDate();
      
      // MiesiÄ…c z uwzglÄ™dnieniem stulecia (dla uproszczenia tylko 1900-1999)
      const month = mm < 10 ? '0'+mm : mm;
      const day = dd < 10 ? '0'+dd : dd;

      // Losowe 3 cyfry
      const random3 = String(Math.floor(Math.random()*1000)).padStart(3,'0');

      // 9 cyfra - pÅ‚eÄ‡: parzysta kobieta, nieparzysta mÄ™Å¼czyzna
      let genderDigit = Math.floor(Math.random()*5)*2;
      if (gender === "MÄ˜Å»CZYZNA") genderDigit += 1;

      // suma kontrolna (prosta wersja)
      const peselWithoutChecksum = `${yy}${month}${day}${random3}${genderDigit}`;
      let sum = 1*peselWithoutChecksum[0] + 3*peselWithoutChecksum[1] + 7*peselWithoutChecksum[2] + 9*peselWithoutChecksum[3]
              + 1*peselWithoutChecksum[4] + 3*peselWithoutChecksum[5] + 7*peselWithoutChecksum[6] + 9*peselWithoutChecksum[7]
              + 1*peselWithoutChecksum[8] + 3*peselWithoutChecksum[9];
      const checksum = (10 - (sum % 10)) % 10;

      return peselWithoutChecksum + checksum;
    }

    // Zapis danych
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const dane1 = document.getElementById("dane1").value;
      const dane2 = document.getElementById("dane2").value;
      const zdjecieInput = document.getElementById("zdjecie").files[0];
      const birthdate = birthdateInput.value;
      const gender = genderSelect.value;
      const pesel = peselValue.textContent;

      if (!birthdate || !gender) {
        alert('Wybierz wszystkie dane!');
        return;
      }

      const reader = new FileReader();
      reader.onload = () => {
        localStorage.setItem("dane1", dane1);
        localStorage.setItem("dane2", dane2);
        localStorage.setItem("zdjecie", reader.result);
        localStorage.setItem("birthdate", birthdate);
        localStorage.setItem("gender", gender);
        localStorage.setItem("pesel", pesel);
        window.location.href = "logowanie.html";
      };
      reader.readAsDataURL(zdjecieInput);
    });
  </script>
</body>
</html>