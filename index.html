<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formularz mDowód</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
input, select { margin-bottom: 10px; width: 100%; padding: 8px; }
button { padding: 10px 20px; font-weight: bold; cursor: pointer; }
</style>
</head>
<body>
<h2>Wprowadź swoje dane</h2>
<form id="form">
  <input type="text" id="imie" placeholder="Imię">
  <input type="text" id="nazwisko" placeholder="Nazwisko">
  <select id="plec">
    <option value="">Wybierz płeć</option>
    <option value="M">Mężczyzna</option>
    <option value="K">Kobieta</option>
  </select>
  <input type="date" id="birthdate">
  <input type="text" id="daneOjca" placeholder="Imię ojca">
  <input type="text" id="daneMatki" placeholder="Imię matki">
  <input type="text" id="miejsceUrodzenia" placeholder="Miejsce urodzenia">
  <input type="text" id="adres" placeholder="Adres zameldowania (linia1|linia2)">
  <input type="date" id="dataZameldowania" placeholder="Data zameldowania">
  <input type="file" id="zdjecie" accept="image/*">
  <button type="submit">Zapisz i przejdź do dowodu</button>
</form>

<script>
function generatePesel(birthdate, gender) {
  if (!birthdate || !gender) return '';
  const date = new Date(birthdate);
  let year = date.getFullYear();
  let month = date.getMonth() + 1;
  let day = date.getDate();

  // Obsługa XX wieku (1900-1999)
  if (year >= 2000) month += 20; // dla XXI wieku
  let y = String(year).slice(2);
  let m = String(month).padStart(2,'0');
  let d = String(day).padStart(2,'0');

  let genderDigit = gender === 'M' ? 1 : 0;
  let serial = Math.floor(Math.random()*999);
  serial = String(serial).padStart(3,'0');
  return y + m + d + serial + genderDigit;
}

document.getElementById('form').addEventListener('submit', function(e){
  e.preventDefault();
  const imie = document.getElementById('imie').value;
  const nazwisko = document.getElementById('nazwisko').value;
  const plec = document.getElementById('plec').value;
  const birthdate = document.getElementById('birthdate').value;
  const daneOjca = document.getElementById('daneOjca').value;
  const daneMatki = document.getElementById('daneMatki').value;
  const miejsceUrodzenia = document.getElementById('miejsceUrodzenia').value;
  const adres = document.getElementById('adres').value;
  const dataZameldowania = document.getElementById('dataZameldowania').value;

  const file = document.getElementById('zdjecie').files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(){
      localStorage.setItem('zdjecie', reader.result);
      saveData();
    }
    reader.readAsDataURL(file);
  } else {
    saveData();
  }

  function saveData(){
    localStorage.setItem('dane1', imie);
    localStorage.setItem('dane2', nazwisko);
    localStorage.setItem('plec', plec);
    localStorage.setItem('birthdate', birthdate);
    localStorage.setItem('daneOjca', daneOjca);
    localStorage.setItem('daneMatki', daneMatki);
    localStorage.setItem('miejsceUrodzenia', miejsceUrodzenia);
    localStorage.setItem('adres', adres);
    localStorage.setItem('dataZameldowania', dataZameldowania);
    const pesel = generatePesel(birthdate, plec);
    localStorage.setItem('pesel', pesel);
    window.location.href = 'dowodnowy.html';
  }
});
</script>
</body>
</html>